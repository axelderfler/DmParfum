<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Catálogo de Perfumes | Dm Parfum</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link rel="icon" type="image/png" href="img/Logo IG PNG.png">
</head> 
<body>
    <!-- Header -->
  <header class="header">
    <nav class="header">
      <div class="nav-container">
        <a href="https://axelderfler.github.io/DmParfum/" style="text-decoration: none;">
          <div class="logo">
              <img src="img/Logo PNG.png" alt="Dm Parfum Logo" class="logo-image">
            <div class="logo-text">
              <h1>Dm Parfum</h1>
              <span class="tagline">Perfumes Árabes</span>
            </div>
          </div>
        </a>
        <ul class="nav-menu">
          <li><a href="index.html" class="nav-link">Inicio</a></li>
          <li><a href="catalogo.html" class="nav-link">Catálogo</a></li>
          <li><a href="index.html#sobre-nosotros" class="nav-link">Nosotros</a></li>
          <li><a href="index.html#contacto" class="nav-link">Contacto</a></li>
        </ul>
        <!-- Carrito de compras -->
        <div class="cart-icon" onclick="toggleCart()">
          <i class="fas fa-shopping-cart"></i>
          <span class="cart-count" id="cart-count">0</span>
        </div>
        <div class="hamburger">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
    </nav>
  </header>

  <!-- Hero Section del Catálogo -->
  <main class="catalog-hero">
    <div class="catalog-hero-content">
      <div class="catalog-hero-text">
        <h1>Catálogo Dm Parfum</h1>
        <p>Descubre nuestra exclusiva colección de perfumes árabes auténticos</p>
      </div>
      <div class="catalog-hero-visual">
        <div class="floating-perfume">
          <img src="img/Logo PNG.png" class="logo-catalogo" alt="">
        </div>
      </div>
    </div>
  </main>

  <!-- Barra de herramientas -->
  <section class="catalog-toolbar">
    <div class="container-info">
      <div class="toolbar-content">
        <div class="toolbar-left">
          <div class="results-info">
            <span id="results-count">Mostrando todos los productos</span>
          </div>
        </div>
        <div class="toolbar-right">
          <!-- Botón de filtros para móvil -->
          <button class="mobile-filters-btn" id="mobile-filters-btn" onclick="if(typeof openMobileFilters === 'function') { openMobileFilters(); } else { console.error('openMobileFilters no está disponible'); } return false;">
            <i class="fas fa-filter"></i>
            <span>Filtros</span>
            <span class="filter-count" id="filter-count">0</span>
          </button>
          <div class="searchbar" id="searchbar">
            <i class="fas fa-search search-icon" aria-hidden="true"></i>
            <input type="text" id="search-input" placeholder="Buscar perfume..." aria-label="Buscar perfume por nombre" autocomplete="off">
            <button type="button" class="clear-search" id="clear-search" title="Limpiar búsqueda">
              <i class="fas fa-times" aria-hidden="true"></i>
            </button>
          </div>
          <div class="sort-controls">
            <label for="ordenar-select">Ordenar por:</label>
            <select id="ordenar-select" class="sort-select">
              <option value="relevantes" selected>Más relevantes</option>
              <option value="precio-desc">Mayor precio</option>
              <option value="precio-asc">Menor precio</option>
              <option value="nombre-az">Nombre A-Z</option>
              <option value="nombre-za">Nombre Z-A</option>
            </select>
          </div>
          <div class="view-controls">
            <button class="view-btn active" data-view="grid" title="Vista de cuadrícula">
              <i class="fas fa-th"></i>
            </button>
            <button class="view-btn" data-view="list" title="Vista de lista">
              <i class="fas fa-list"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- Layout principal -->
  <section class="catalog-main">
    <div class="container">
      <div class="catalog-layout">
        <aside class="sidebar-filtros">
          <div class="filters-header">
            <h3><i class="fas fa-filter"></i> Filtros</h3>
            <button class="clear-filters-btn" onclick="clearAllFilters()">
              <i class="fas fa-times"></i> Limpiar
            </button>
          </div>
          
          <div class="filtros-group">
            <h4><i class="fas fa-tags"></i> Categoría</h4>
            <div class="filter-buttons">
              <button class="filter-btn active" data-filter="all">
                <i class="fas fa-layer-group"></i> Todos
              </button>
              <button class="filter-btn" data-filter="masculino">
                <i class="fas fa-male"></i> Masculinos
              </button>
              <button class="filter-btn" data-filter="femenino">
                <i class="fas fa-female"></i> Femeninos
              </button>
              <button class="filter-btn" data-filter="unisex">
                <i class="fas fa-venus-mars"></i> Unisex
              </button>
            </div>
          </div>

          <div class="filtros-group" id="filtro-marca">
            <h4><i class="fas fa-crown"></i> Marca</h4>
            <div class="brand-filters" id="brand-filters">
              <!-- Las marcas se cargarán dinámicamente -->
            </div>
          </div>

          <div class="filtros-group">
            <h4><i class="fas fa-warehouse"></i> Disponibilidad</h4>
            <div class="checkbox-filter">
              <label class="checkbox-label">
                <input type="checkbox" id="filtro-stock">
                <span class="checkmark"></span>
                <span class="label-text">Solo con stock</span>
              </label>
            </div>
          </div>

          <div class="filtros-group">
            <h4><i class="fas fa-dollar-sign"></i> Precio</h4>
            <div class="price-range">
              <div class="price-inputs">
                <input type="number" id="precio-min" placeholder="Mín" class="price-input">
                <span class="price-separator">-</span>
                <input type="number" id="precio-max" placeholder="Máx" class="price-input">
              </div>
              <button class="apply-price-btn" onclick="applyPriceFilter()">
                <i class="fas fa-check"></i> Aplicar
              </button>
            </div>
          </div>
        </aside>
        
        <div class="catalogo-main">
          <div class="products-header">
            <div class="products-count">
              <span id="products-count-text">0 productos encontrados</span>
            </div>
            <div class="loading-indicator" id="loading-indicator" style="display: none;">
              <i class="fas fa-spinner fa-spin"></i> Cargando productos...
            </div>
          </div>
          
          <div id="products-grid" class="products-grid"></div>
          
          <div class="no-products" id="no-products" style="display: none;">
            <div class="no-products-content">
              <i class="fas fa-search"></i>
              <h3>No se encontraron productos</h3>
              <p>Intenta ajustar los filtros para ver más opciones</p>
              <button class="btn btn-primary" onclick="clearAllFilters()">
                <i class="fas fa-refresh"></i> Limpiar filtros
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Modal de filtros móvil -->
  <div class="mobile-filters-modal" id="mobile-filters-modal">
    <div class="mobile-filters-content">
      <div class="mobile-filters-header">
        <h3><i class="fas fa-filter"></i> Filtros</h3>
        <button class="close-mobile-filters" id="close-mobile-filters" onclick="if(typeof closeMobileFilters === 'function'){ closeMobileFilters(); } else { console.error('closeMobileFilters no está disponible'); } return false;">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="mobile-filters-body" id="mobile-filters-content">
        <!-- El contenido se copiará dinámicamente desde el sidebar -->
      </div>
      <div class="mobile-filters-footer">
        <button class="btn btn-secondary" onclick="clearAllFilters()">
          <i class="fas fa-times"></i> Limpiar
        </button>
        <button class="btn btn-primary" id="apply-mobile-filters" onclick="if(typeof copyFiltersFromMobile==='function'){copyFiltersFromMobile();} if(typeof filterProducts==='function'){filterProducts();} if(typeof updateFilterCount==='function'){updateFilterCount();} if(typeof closeMobileFilters==='function'){closeMobileFilters();} return false;">
          <i class="fas fa-check"></i> Aplicar Filtros
        </button>
      </div>
    </div>
  </div>

  <footer class="footer">
    <div class="container-info">
      <div class="footer-content">
        <div class="footer-section">
          <h3>Dm Parfum</h3>
          <p>Perfumes árabes auténticos para una experiencia única</p>
          <div class="social-links">
            <a href="https://instagram.com/dm.parfum_"><i class="fab fa-instagram"></i></a>
            <a href="https://wa.me/541162634332"><i class="fab fa-whatsapp"></i></a>
          </div>
        </div>
        <div class="footer-section">
          <h4>Enlaces Rápidos</h4>
          <ul>
            <li><a href="index.html">Inicio</a></li>
            <li><a href="catalogo.html">Catálogo</a></li>
            <li><a href="index.html#sobre-nosotros">Nosotros</a></li>
            <li><a href="index.html#contacto">Contacto</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h4>Información</h4>
          <ul>
            <li><a href="#">Política de Privacidad</a></li>
            <li><a href="#">Términos y Condiciones</a></li>
            <li><a href="#">Envíos y Devoluciones</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2024 Dm Parfum. Todos los derechos reservados.</p>
      </div>
    </div>
  </footer>

  <script src="script.js?v=3"></script>
  <script src="cart.js"></script>

  <script>
    // Funciones adicionales para el catálogo mejorado
    function clearAllFilters() {
      // Limpiar filtros de categoría
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelector('[data-filter="all"]').classList.add('active');
      
      // Limpiar filtros de marca
      document.querySelectorAll('#brand-filters input[type="checkbox"]').forEach(checkbox => {
        checkbox.checked = false;
      });
      
      // Limpiar filtro de stock
      document.getElementById('filtro-stock').checked = false;
      
      // Limpiar filtros de precio
      document.getElementById('precio-min').value = '';
      document.getElementById('precio-max').value = '';
      
      // Limpiar buscador
      const searchInput = document.getElementById('search-input');
      if (searchInput) {
        searchInput.value = '';
      }
      if (typeof window !== 'undefined') {
        window.searchQuery = '';
      }
      const searchbarEl = document.getElementById('searchbar');
      if (searchbarEl) {
        searchbarEl.classList.remove('has-value');
      }
      
      // Aplicar filtros
      if (typeof applyInitialFilter === 'function') {
        applyInitialFilter();
      }
      if (typeof filterProducts === 'function') {
        filterProducts();
      }
      if (typeof updateFilterCount === 'function') {
        updateFilterCount();
      }
      if (typeof mobileFiltersModal !== 'undefined' && mobileFiltersModal && mobileFiltersModal.classList.contains('active')) {
        if (typeof copyFiltersToMobile === 'function') {
          copyFiltersToMobile();
        }
      }
    }

    function applyPriceFilter() {
      const minPrice = document.getElementById('precio-min').value;
      const maxPrice = document.getElementById('precio-max').value;
      
      if (minPrice || maxPrice) {
        // Aplicar filtro de precio
        if (typeof filterProducts === 'function') {
          filterProducts();
        }
      }
    }

    function updateProductsCount(count) {
      const countElement = document.getElementById('products-count-text');
      const resultsElement = document.getElementById('results-count');
      
      if (countElement) {
        countElement.textContent = `${count} producto${count !== 1 ? 's' : ''} encontrado${count !== 1 ? 's' : ''}`;
      }
      
      if (resultsElement) {
        resultsElement.textContent = `Mostrando ${count} producto${count !== 1 ? 's' : ''}`;
      }
    }

    function showLoadingIndicator() {
      document.getElementById('loading-indicator').style.display = 'flex';
    }

    function hideLoadingIndicator() {
      document.getElementById('loading-indicator').style.display = 'none';
    }

    function showNoProducts() {
      document.getElementById('no-products').style.display = 'block';
      document.getElementById('products-grid').style.display = 'none';
    }

    function hideNoProducts() {
      document.getElementById('no-products').style.display = 'none';
      document.getElementById('products-grid').style.display = 'grid';
    }

    // Inicialización mejorada del catálogo
    document.addEventListener('DOMContentLoaded', function() {
      // Inicialización correcta para que los filtros y marcas funcionen SIEMPRE
      if (typeof loadProductsFromGoogleSheets === 'function') {
        showLoadingIndicator();
        
        loadProductsFromGoogleSheets().then(() => {
          hideLoadingIndicator();
          
          if (typeof initializeFilters === 'function') initializeFilters();
          if (typeof applyInitialFilter === 'function') applyInitialFilter();
          if (typeof loadProducts === 'function') loadProducts();
          
          // Esperar un poco para que se rendericen los productos
          setTimeout(() => {
            // Actualizar contador de productos
            const products = document.querySelectorAll('.product-card');
            updateProductsCount(products.length);
            
            // Mostrar/ocultar mensaje de no productos
            if (products.length === 0) {
              showNoProducts();
            } else {
              hideNoProducts();
            }
          }, 100);
        }).catch(error => {
          hideLoadingIndicator();
          console.error('Error cargando productos:', error);
        });
      }

      // Control de vista (grid/list)
      document.querySelectorAll('.view-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          
          const view = this.dataset.view;
          const productsGrid = document.getElementById('products-grid');
          
          if (view === 'list') {
            productsGrid.classList.add('list-view');
          } else {
            productsGrid.classList.remove('list-view');
          }
        });
      });

      // Control de ordenamiento
      document.getElementById('ordenar-select').addEventListener('change', function() {
        if (typeof sortProducts === 'function') {
          sortProducts(this.value);
        }
      });
    });
  </script>
</body>
</html>